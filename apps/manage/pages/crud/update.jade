extends ../../layouts/index

block append title

block append meta

block append stylesheet

block append headjs

block append content
  // Main content
  section.content
    form(role="form",data-module="manage_form",data-db=result.db,data-collection=result.collection)
      div
        - var data = result.data[result.db][result.collection];
        - var schema = result._data[result.config.schema.db][result.config.schema.collection];
        - var controls = result._data[result.config.control.db][result.config.control.collection];
        if data && data._id
          +manage_ctrl_input({
            name:'_id',
            type:'hidden',
            value:(data ? data._id + '' : '')
          })
        each field in schema.fields
          - var extra_componets = controls.filter(function(v){
          //- - console.log(v.name,field.type)
          -   return v.name == field.type
          - })
          - field.base = extra_componets[0].base || field.type;
          - var baseCtrl = controls.filter(function(v){
          -   return v._id == field.base;
          - })
          if !baseCtrl || baseCtrl.length === 0
            - field.base = field.type;
          else
            - field.base = baseCtrl[0].name;
          if field.base === 'tagsinput'
            -var params = {};
            -params.label = field.alias;
            -params.name =field.name,
            -params.value = data ? (Array.isArray(data[field.name]) ? data[field.name].join(' ') : data[field.name]) : ''
            - for(var key in extra_componets[0].params){
            -   params[key] = extra_componets[0].params[key]
            - }
            +manage_ctrl_tagsinput(params)
          else if field.base === 'orderwizard'
            -var params = {};
            -params.label = field.alias;
            -params.name =field.name;
            -params.data = data;
            //- -params.value = data ? (Array.isArray(data[field.name]) ? data[field.name].join(' ') : data[field.name]) : ''
            - for(var key in extra_componets[0].params){
            -   params[key] = extra_componets[0].params[key]
            - }
            +manage_ctrl_orderwizard(params)
          else if field.base === 'select'
            -var params = {};
            -params.label = field.alias;
            -params.name =field.name;
            -params.data = data;
            -params.value = data ? data[field.name] : field.defaults
            - for(var key in extra_componets[0].params){
            -   params[key] = extra_componets[0].params[key]
            - }
            +manage_ctrl_select(params)
          else
            -var params = {};
            -params.label = field.alias;
            -params.name =field.name,
            -params.value = data ? data[field.name] : field.defaults
            if extra_componets[0].params
              - for(var key in extra_componets[0].params)
              -   params[key] = extra_componets[0].params[key]
            +manage_ctrl_input(params)
      +manage_box({
        title:'表定义'
      })
      .form-group
        button.btn.btn-primary.btn-schema-add(type="submit") 确定
        | 
        a.btn.btn-default.btn-cancel 取消

block append footjs
  script(type="text/javascript",src="//static.nyouhui.com/dist/js/manage/crud.min.771cb8310fa19b85.js")